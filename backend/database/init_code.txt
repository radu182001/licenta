CREATE TABLE Users (
    ID SERIAL PRIMARY KEY,
    Username VARCHAR(255) UNIQUE NOT NULL,
    Email VARCHAR(255) UNIQUE NOT NULL,
    Password VARCHAR(255) NOT NULL,
    FirstName VARCHAR(255) NOT NULL,
    LastName VARCHAR(255) NOT NULL,
    CreatedAt TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    LastModifiedAt TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE Projects (
    ID SERIAL PRIMARY KEY,
    Name VARCHAR(255) NOT NULL,
    Description TEXT,
    OwnerID INT NOT NULL REFERENCES Users(ID),
    CreatedAt TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    LastModifiedAt TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE UserProjects (
    UserID INT REFERENCES Users(ID),
    ProjectID INT REFERENCES Projects(ID),
    Role VARCHAR(20) NOT NULL,
    PRIMARY KEY (UserID, ProjectID)
);

CREATE TABLE File (
    ID SERIAL PRIMARY KEY,
    Name VARCHAR(255) NOT NULL,
    Key VARCHAR(255) NOT NULL,
    Size INT NOT NULL,
    Format VARCHAR(50) NOT NULL,
    UserID INT NOT NULL REFERENCES Users(ID),
    ProjectID INT REFERENCES Projects(ID),
    Timestamp TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE ArrangeFile (
    ProjectID INT REFERENCES Projects(ID),
    FileID INT REFERENCES File(ID),
    PRIMARY KEY (ProjectID, FileID)
);

CREATE TABLE DawAudio (
    ID SERIAL PRIMARY KEY,
    ProjectID INT REFERENCES Projects(ID),
    FileID INT REFERENCES File(ID),
    X real NOT NULL, 
    StartTime real NOT NULL,
    EndTime real NOT NULL,
    TrackIndex INT NOT NULL
);

CREATE TABLE Lyrics (
    ID SERIAL PRIMARY KEY,
    ProjectID INT REFERENCES Projects(ID),
    Content VARCHAR(1000) NOT NULL
);

CREATE TABLE Conversations (
    ID SERIAL PRIMARY KEY,
    Name VARCHAR(255),
    ProjectID INT REFERENCES Projects(ID)
);

CREATE TABLE Participants (
    UserID INT REFERENCES Users(ID) ON DELETE CASCADE,
    ConversationID INT REFERENCES Conversations(ID) ON DELETE CASCADE,
    PRIMARY KEY (UserID, ConversationID)
);

CREATE TABLE Messages (
    ID SERIAL PRIMARY KEY,
    SenderID INT REFERENCES Users(ID) ON DELETE CASCADE,
    ConversationID INT REFERENCES Conversations(ID) ON DELETE CASCADE,
    Content TEXT,
    Timestamp TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);